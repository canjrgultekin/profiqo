!function(){"use strict";var e={DEFAULT_API_BASE:"http://localhost:5164",EVENTS_ENDPOINT:"/api/v1/events/storefront",CONFIG_ENDPOINT:"/api/v1/events/storefront/config",DEVICE_ID_COOKIE:"_pfq_did",SESSION_ID_KEY:"_pfq_sid",CUSTOMER_KEY:"_pfq_cust",TENANT_KEY:"_pfq_tenant",COOKIE_MAX_AGE_DAYS:730,SESSION_TIMEOUT_MS:18e5,BATCH_INTERVAL_MS:2e3,MAX_QUEUE_SIZE:20,MAX_RETRIES:2,RETRY_DELAY_MS:1e3,SUBSCRIBE_ID:"profiqo_storefront_tracker_v2",POLL_INTERVAL_MS:200,MAX_POLLS:50,SUPPORTED_EVENTS:{ADDTOCART:"ADD_TO_CART",REMOVEFROMCART:"REMOVE_FROM_CART",COMPLETECHECKOUT:"COMPLETE_CHECKOUT",ADDTOWISHLIST:"ADD_TO_WISHLIST"},IKAS_STRING_EVENTS:{addtocart:"ADD_TO_CART",removefromcart:"REMOVE_FROM_CART",completecheckout:"COMPLETE_CHECKOUT",addtowishlist:"ADD_TO_WISHLIST"},IKAS_EVENT_TYPES:{1:"PAGE_VIEW",2:"PRODUCT_VIEW",3:"REMOVE_FROM_CART",4:"ADD_TO_CART",5:"BEGIN_CHECKOUT",6:"COMPLETE_CHECKOUT",7:"SEARCH",8:"ADD_TO_WISHLIST",12:"COMPLETE_CHECKOUT",16:"ADD_TO_WISHLIST"}},t=document.currentScript,n=null,r=e.DEFAULT_API_BASE;if(t&&t.src)try{var a=new URLSearchParams(t.src.split("?")[1]||"");n=a.get("apiKey")||a.get("publicApiKey")||a.get("key");var i=a.get("endpoint")||a.get("url");i&&(r=i.replace(/\/+$/,""))}catch(e){var u=t.src.match(/[?&]apiKey=([^&]+)/);u&&(n=decodeURIComponent(u[1]))}if(n){var l=null,o=null;l=A();var c,s=null;try{var d=sessionStorage.getItem(e.TENANT_KEY);d&&(s=JSON.parse(d))}catch(e){}c=r+e.CONFIG_ENDPOINT+"?apiKey="+encodeURIComponent(n),"function"==typeof fetch&&fetch(c,{method:"GET",mode:"cors",credentials:"omit"}).then(function(e){return e.json()}).then(function(t){if(t&&t.tenantId){s={tenantId:t.tenantId,tenantName:t.tenantName||null,storeDomain:t.storeDomain||window.location.hostname,enabledEvents:t.enabledEvents||Object.values(e.SUPPORTED_EVENTS)};try{sessionStorage.setItem(e.TENANT_KEY,JSON.stringify(s))}catch(e){}}}).catch(function(){});var _,m=[],p=null,f=((_=v(e.DEVICE_ID_COOKIE))||(_=T(),function(e,t,n){var r="";if(n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3),r="; expires="+a.toUTCString()}document.cookie=e+"="+encodeURIComponent(t)+r+"; path=/; SameSite=Lax; Secure"}(e.DEVICE_ID_COOKIE,_,e.COOKIE_MAX_AGE_DAYS)),_);if(window.addEventListener("beforeunload",function(){y()}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&y()}),!L())var E=0,I=setInterval(function(){E++,(L()||E>=e.MAX_POLLS)&&(clearInterval(I),E>=e.MAX_POLLS&&console.warn("[Profiqo] window.IkasEvents "+e.MAX_POLLS*e.POLL_INTERVAL_MS+"ms içinde bulunamadı."))},e.POLL_INTERVAL_MS);window.__profiqo={version:"2.1.0",apiKey:n,deviceId:f,getCustomer:function(){return l||A()},getTenant:function(){return s},flush:y,track:function(e,t){P({type:e,data:t})}}}else console.warn("[Profiqo] apiKey bulunamadı. Script src'ye ?apiKey=YOUR_KEY ekleyin.");function T(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function v(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?decodeURIComponent(t[2]):null}function S(){var t=Date.now(),n=null;try{n=sessionStorage.getItem(e.SESSION_ID_KEY)}catch(e){}if(n)try{var r=JSON.parse(n);if(t-r.ts<e.SESSION_TIMEOUT_MS){r.ts=t;try{sessionStorage.setItem(e.SESSION_ID_KEY,JSON.stringify(r))}catch(e){}return r.id}}catch(e){}var a=T();try{sessionStorage.setItem(e.SESSION_ID_KEY,JSON.stringify({id:a,ts:t}))}catch(e){}return a}function O(){return{url:window.location.href,path:window.location.pathname,referrer:document.referrer||null,title:document.title||null,userAgent:navigator.userAgent,language:navigator.language||null,screenWidth:window.screen?window.screen.width:null,screenHeight:window.screen?window.screen.height:null}}function A(){if(o&&o.ud){var t=o.ud;if(t.id||t.em)return{id:t.id||null,email:t.em||null,firstName:t.fn||null,lastName:t.ln||null,phone:t.ph||null,isGuest:!1}}if(window.__ikas__&&window.__ikas__.customer){var n=window.__ikas__.customer;if(n.id||n.email)return{id:n.id||null,email:n.email||null,firstName:n.firstName||null,lastName:n.lastName||null,phone:n.phone||null,isGuest:!1}}if(window.__NEXT_DATA__&&window.__NEXT_DATA__.props){var r=window.__NEXT_DATA__.props.pageProps||window.__NEXT_DATA__.props,a=r.customer||r.currentCustomer||r.user;if(a&&(a.id||a.email))return{id:a.id||null,email:a.email||null,firstName:a.firstName||null,lastName:a.lastName||null,phone:a.phone||null,isGuest:!1}}var i=v("ikas_ct")||v("ikas_customer_token");if(i)try{var u=i.split(".");if(3===u.length){var l=JSON.parse(atob(u[1].replace(/-/g,"+").replace(/_/g,"/")));if(l.sub||l.customerId||l.email)return{id:l.sub||l.customerId||null,email:l.email||null,firstName:l.firstName||null,lastName:l.lastName||null,phone:null,isGuest:!1}}}catch(e){}try{var c=sessionStorage.getItem(e.CUSTOMER_KEY);if(c){var s=JSON.parse(c);if(s&&(s.id||s.email||s.phone))return s}}catch(e){}return{id:null,email:null,firstName:null,lastName:null,phone:null,isGuest:!0}}function N(t){if(t&&(t.id||t.email||t.phone)){var n=l||{};l={id:t.id||n.id||null,email:t.email||n.email||null,firstName:t.firstName||n.firstName||null,lastName:t.lastName||n.lastName||null,phone:t.phone||n.phone||null,isGuest:!t.id&&!n.id};try{sessionStorage.setItem(e.CUSTOMER_KEY,JSON.stringify(l))}catch(e){}}}function y(){if(0!==m.length){var t=m.splice(0,e.MAX_QUEUE_SIZE),r=l||A();h(JSON.stringify({apiKey:n,deviceId:f,sessionId:S(),sentAt:(new Date).toISOString(),customer:r,tenant:s?{tenantId:s.tenantId,tenantName:s.tenantName,storeDomain:s.storeDomain}:{storeDomain:window.location.hostname},events:t}),0)}}function h(t,n){var a=r+e.EVENTS_ENDPOINT;if(navigator.sendBeacon&&0===n){var i=new Blob([t],{type:"text/plain"});if(navigator.sendBeacon(a,i))return}if("function"!=typeof fetch)try{var u=new XMLHttpRequest;u.open("POST",a,!0),u.setRequestHeader("Content-Type","application/json"),u.onerror=function(){n<e.MAX_RETRIES&&setTimeout(function(){h(t,n+1)},e.RETRY_DELAY_MS*Math.pow(2,n))},u.send(t)}catch(e){}else fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:t,keepalive:!0,mode:"cors",credentials:"omit"}).catch(function(){n<e.MAX_RETRIES&&setTimeout(function(){h(t,n+1)},e.RETRY_DELAY_MS*Math.pow(2,n))})}function C(t){if(m.push(t),m.length>=e.MAX_QUEUE_SIZE)return clearTimeout(p),void y();p||(p=setTimeout(function(){p=null,y()},e.BATCH_INTERVAL_MS))}function g(e){return e?{productId:e.pid||null,variantId:e.vid||null,quantity:e.c||e.q||1,price:e.p||null}:{}}function D(e,t){switch(e){case"ADD_TO_CART":case"REMOVE_FROM_CART":return function(e){if(!e)return{};var t={};if(e.crtItm){var n=g(e.crtItm);t.productId=n.productId,t.variantId=n.variantId,t.quantity=n.quantity,t.price=n.price}if(e.crt){var r=function(e){if(!e)return{};var t={cartId:e.id||null,currency:e.c||"TRY",cartTotalPrice:e.pr||null,cartItemCount:e.il?e.il.length:null};return e.il&&Array.isArray(e.il)&&(t.items=e.il.map(function(e){return g(e)})),t}(e.crt);t.cartId=r.cartId,t.currency=r.currency,t.cartTotalPrice=r.cartTotalPrice,t.cartItemCount=r.cartItemCount,t.cartItems=r.items}return t}(t);case"COMPLETE_CHECKOUT":return function(e){if(!e)return{};var t=e.ord||e,n={};n.orderId=t.id||t.oid||null,n.orderNumber=t.on||t.orderNumber||null,n.totalPrice=t.pr||t.tp||null,n.currency=t.c||"TRY";var r=t.il||t.items;return r&&Array.isArray(r)&&(n.itemCount=r.length,n.items=r.map(function(e){return g(e)})),n}(t);case"ADD_TO_WISHLIST":return function(e){if(!e)return{};var t=e.pr||e.prd||e;return{productId:t.id||t.pid||null,variantId:t.vid||null}}(t);default:return t||{}}}function R(t){var n=e.IKAS_EVENT_TYPES[t];return n&&-1!==["ADD_TO_CART","REMOVE_FROM_CART","COMPLETE_CHECKOUT","ADD_TO_WISHLIST"].indexOf(n)?n:null}function w(t){if(!t)return null;if("number"==typeof t)return R(t);var n=t.toLowerCase().replace(/[_\-\s]/g,""),r=e.IKAS_STRING_EVENTS[n];if(r)return r;var a=t.toUpperCase().replace(/[_\-\s]/g,"");return e.SUPPORTED_EVENTS[a]||null}function M(e){return!s||!s.enabledEvents||-1!==s.enabledEvents.indexOf(e)}function P(e){try{if(!e)return;var t=e.e&&Array.isArray(e.e),n="string"==typeof e.type||"number"==typeof e.type;if(n&&e.data&&"object"==typeof e.data&&!t){var r=w(e.type);if(!r||!M(r))return;var a,i=e.data,u=function(e){if(!e)return null;var t=null,n=null,r=null,a=null;e.cart&&e.cart.customer?t=e.cart.customer:e.order&&e.order.customer?t=e.order.customer:e.customer&&(e.customer.id||e.customer.email)&&(t=e.customer);var i=null;e.cart&&e.cart.shippingAddress?i=e.cart.shippingAddress:e.order&&e.order.shippingAddress?i=e.order.shippingAddress:e.shippingAddress&&(i=e.shippingAddress),i&&(n=i.phone||null,r=i.firstName||null,a=i.lastName||null);var u=null;return e.cart&&e.cart.customerId&&(u=e.cart.customerId),t&&(t.id||t.email)?{id:t.id||u||null,email:t.email||null,firstName:t.firstName||r||null,lastName:t.lastName||a||null,phone:t.phone||n||null,isGuest:!0===t.isGuestCheckout}:u?{id:u,email:null,firstName:r||null,lastName:a||null,phone:n||null,isGuest:!1}:n?{id:null,email:null,firstName:r||null,lastName:a||null,phone:n,isGuest:!0}:null}(i);switch(u&&N(u),r){case"ADD_TO_CART":case"REMOVE_FROM_CART":a=function(e){if(!e)return{};var t={},n=e.item;n&&(t.quantity=e.quantity||n.quantity||1,t.price=n.finalPrice||n.price||null,t.currency=n.currencyCode||"TRY",n.variant&&(t.productId=n.variant.productId||null,t.variantId=n.variant.id||null,t.productName=n.variant.name||null,t.productSlug=n.variant.slug||null,n.variant.brand&&(t.brandName=n.variant.brand.name||null),n.variant.categories&&n.variant.categories.length>0&&(t.categoryName=n.variant.categories[0].name||null)));var r=e.cart;if(r){t.cartId=r.id||null,t.currency=r.currencyCode||t.currency||"TRY",t.cartTotalPrice=r.totalFinalPrice||r.totalPrice||null;var a=r.orderLineItems;a&&Array.isArray(a)&&(t.cartItemCount=a.length,t.cartItems=a.map(function(e){return{productId:e.variant?e.variant.productId:null,variantId:e.variant?e.variant.id:null,quantity:e.quantity||1,price:e.finalPrice||e.price||null,productName:e.variant?e.variant.name:null}}))}return t}(i);break;case"COMPLETE_CHECKOUT":a=function(e){if(!e)return{};var t=e.order||e.cart||e,n={};n.orderId=t.id||null,n.orderNumber=t.orderNumber||null,n.totalPrice=t.totalFinalPrice||t.totalPrice||null,n.currency=t.currencyCode||"TRY";var r=t.orderLineItems;return r&&Array.isArray(r)&&(n.itemCount=r.length,n.items=r.map(function(e){return{productId:e.variant?e.variant.productId:null,variantId:e.variant?e.variant.id:null,quantity:e.quantity||1,price:e.finalPrice||e.price||null,productName:e.variant?e.variant.name:null}})),n}(i);break;case"ADD_TO_WISHLIST":a=function(e){return e?{productId:e.productId||(e.product?e.product.id:null)||null,variantId:e.variantId||null}:{}}(i);break;default:a=i||{}}return void C({eventId:T(),type:r,occurredAt:(new Date).toISOString(),data:a,page:O(),customer:l||A()})}if(n&&!t){var c=w(e.type);if(!c||!M(c))return;return void C({eventId:T(),type:c,occurredAt:(new Date).toISOString(),data:e.data||{},page:O(),customer:l||A()})}if(!t)return;o=e,e.ud&&(e.ud.id||e.ud.em)&&N({id:e.ud.id||null,email:e.ud.em||null,firstName:e.ud.fn||null,lastName:e.ud.ln||null,phone:e.ud.ph||null,isGuest:!1});var s=l||A();e.e.forEach(function(e){var t=R(e.t);if(t&&M(t)){var n=D(t,e.d&&e.d.d?e.d.d:{}),r=O();e.d&&(e.d.u&&(r.url=e.d.u),e.d.r&&(r.referrer=e.d.r)),C({eventId:e.id||T(),type:t,occurredAt:e.ts?new Date(e.ts).toISOString():(new Date).toISOString(),data:n,page:r,customer:s})}})}catch(e){}}function L(){return void 0!==window.IkasEvents&&"function"==typeof window.IkasEvents.subscribe&&(window.IkasEvents.subscribe({id:e.SUBSCRIBE_ID,callback:P}),!0)}}();