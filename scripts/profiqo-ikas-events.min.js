!function(){"use strict";var e={DEFAULT_API_BASE:"https://api.profiqo.com",EVENTS_ENDPOINT:"/api/v1/events/storefront",CONFIG_ENDPOINT:"/api/v1/events/storefront/config",DEVICE_ID_COOKIE:"_pfq_did",SESSION_ID_KEY:"_pfq_sid",CUSTOMER_KEY:"_pfq_cust",TENANT_KEY:"_pfq_tenant",COOKIE_MAX_AGE_DAYS:730,SESSION_TIMEOUT_MS:18e5,BATCH_INTERVAL_MS:2e3,MAX_QUEUE_SIZE:20,MAX_RETRIES:2,RETRY_DELAY_MS:1e3,SUBSCRIBE_ID:"profiqo_storefront_tracker_v2",POLL_INTERVAL_MS:200,MAX_POLLS:50,SUPPORTED_EVENTS:{ADDTOCART:"ADD_TO_CART",REMOVEFROMCART:"REMOVE_FROM_CART",COMPLETECHECKOUT:"COMPLETE_CHECKOUT",ADDTOWISHLIST:"ADD_TO_WISHLIST"},IKAS_EVENT_TYPES:{1:"PAGE_VIEW",2:"PRODUCT_VIEW",3:"REMOVE_FROM_CART",4:"ADD_TO_CART",5:"BEGIN_CHECKOUT",6:"COMPLETE_CHECKOUT",7:"SEARCH",8:"ADD_TO_WISHLIST",12:"COMPLETE_CHECKOUT",16:"ADD_TO_WISHLIST"}},t=document.currentScript,n=null,r=e.DEFAULT_API_BASE;if(t&&t.src)try{var i=new URLSearchParams(t.src.split("?")[1]||"");n=i.get("apiKey")||i.get("publicApiKey")||i.get("key");var a=i.get("endpoint")||i.get("url");a&&(r=a.replace(/\/+$/,""))}catch(e){var o=t.src.match(/[?&]apiKey=([^&]+)/);o&&(n=decodeURIComponent(o[1]))}if(n){var u=null,l=null;u=A();var c,s=null;try{var d=sessionStorage.getItem(e.TENANT_KEY);d&&(s=JSON.parse(d))}catch(e){}c=r+e.CONFIG_ENDPOINT+"?apiKey="+encodeURIComponent(n),"function"==typeof fetch&&fetch(c,{method:"GET",mode:"cors",credentials:"omit"}).then(function(e){return e.json()}).then(function(t){if(t&&t.tenantId){s={tenantId:t.tenantId,tenantName:t.tenantName||null,storeDomain:t.storeDomain||window.location.hostname,enabledEvents:t.enabledEvents||Object.values(e.SUPPORTED_EVENTS)};try{sessionStorage.setItem(e.TENANT_KEY,JSON.stringify(s))}catch(e){}}}).catch(function(){});var _,E=[],f=null,I=((_=S(e.DEVICE_ID_COOKIE))||(_=T(),function(e,t,n){var r="";if(n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),r="; expires="+i.toUTCString()}document.cookie=e+"="+encodeURIComponent(t)+r+"; path=/; SameSite=Lax; Secure"}(e.DEVICE_ID_COOKIE,_,e.COOKIE_MAX_AGE_DAYS)),_);if(window.addEventListener("beforeunload",function(){N()}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&N()}),!M())var m=0,p=setInterval(function(){m++,(M()||m>=e.MAX_POLLS)&&(clearInterval(p),m>=e.MAX_POLLS&&console.warn("[Profiqo] window.IkasEvents "+e.MAX_POLLS*e.POLL_INTERVAL_MS+"ms içinde bulunamadı."))},e.POLL_INTERVAL_MS);window.__profiqo={version:"2.0.0",apiKey:n,deviceId:I,getCustomer:function(){return u||A()},getTenant:function(){return s},flush:N,track:function(e,t){R({type:e,data:t})}}}else console.warn("[Profiqo] apiKey bulunamadı. Script src'ye ?apiKey=YOUR_KEY ekleyin.");function T(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function S(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?decodeURIComponent(t[2]):null}function O(){var t=Date.now(),n=null;try{n=sessionStorage.getItem(e.SESSION_ID_KEY)}catch(e){}if(n)try{var r=JSON.parse(n);if(t-r.ts<e.SESSION_TIMEOUT_MS){r.ts=t;try{sessionStorage.setItem(e.SESSION_ID_KEY,JSON.stringify(r))}catch(e){}return r.id}}catch(e){}var i=T();try{sessionStorage.setItem(e.SESSION_ID_KEY,JSON.stringify({id:i,ts:t}))}catch(e){}return i}function v(){return{url:window.location.href,path:window.location.pathname,referrer:document.referrer||null,title:document.title||null,userAgent:navigator.userAgent,language:navigator.language||null,screenWidth:window.screen?window.screen.width:null,screenHeight:window.screen?window.screen.height:null}}function A(){if(l&&l.ud){var t=l.ud;if(t.id||t.em)return{id:t.id||null,email:t.em||null,firstName:t.fn||null,lastName:t.ln||null,phone:t.ph||null,isGuest:!1}}if(window.__ikas__&&window.__ikas__.customer){var n=window.__ikas__.customer;return{id:n.id||null,email:n.email||null,firstName:n.firstName||null,lastName:n.lastName||null,phone:n.phone||null,isGuest:!1}}if(window.__NEXT_DATA__&&window.__NEXT_DATA__.props){var r=window.__NEXT_DATA__.props.pageProps||window.__NEXT_DATA__.props,i=r.customer||r.currentCustomer||r.user;if(i&&i.id)return{id:i.id,email:i.email||null,firstName:i.firstName||null,lastName:i.lastName||null,phone:i.phone||null,isGuest:!1}}var a=S("ikas_ct")||S("ikas_customer_token");if(a){try{var o=a.split(".");if(3===o.length){var u=JSON.parse(atob(o[1].replace(/-/g,"+").replace(/_/g,"/")));if(u.sub||u.customerId)return{id:u.sub||u.customerId||null,email:u.email||null,firstName:u.firstName||null,lastName:u.lastName||null,phone:null,isGuest:!1}}}catch(e){}return{id:null,email:null,firstName:null,lastName:null,phone:null,isGuest:!1}}try{var c=sessionStorage.getItem(e.CUSTOMER_KEY);if(c)return JSON.parse(c)}catch(e){}return{id:null,email:null,firstName:null,lastName:null,phone:null,isGuest:!0}}function N(){if(0!==E.length){var t=E.splice(0,e.MAX_QUEUE_SIZE),r=u||A();D(JSON.stringify({apiKey:n,deviceId:I,sessionId:O(),sentAt:(new Date).toISOString(),customer:r,tenant:s?{tenantId:s.tenantId,tenantName:s.tenantName,storeDomain:s.storeDomain}:{storeDomain:window.location.hostname},events:t}),0)}}function D(t,n){var i=r+e.EVENTS_ENDPOINT;if(navigator.sendBeacon&&0===n){var a=new Blob([t],{type:"text/plain"});if(navigator.sendBeacon(i,a))return}if("function"!=typeof fetch)try{var o=new XMLHttpRequest;o.open("POST",i,!0),o.setRequestHeader("Content-Type","application/json"),o.send(t)}catch(e){}else fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:t,keepalive:!0,mode:"cors",credentials:"omit"}).catch(function(){n<e.MAX_RETRIES&&setTimeout(function(){D(t,n+1)},e.RETRY_DELAY_MS*Math.pow(2,n))})}function C(t){if(E.push(t),E.length>=e.MAX_QUEUE_SIZE)return clearTimeout(f),void N();f||(f=setTimeout(function(){f=null,N()},e.BATCH_INTERVAL_MS))}function h(e){return e?{productId:e.pid||null,variantId:e.vid||null,quantity:e.c||e.q||1,price:e.p||null}:{}}function y(t){var n=e.IKAS_EVENT_TYPES[t];return n&&-1!==["ADD_TO_CART","REMOVE_FROM_CART","COMPLETE_CHECKOUT","ADD_TO_WISHLIST"].indexOf(n)?n:null}function w(e){return!s||!s.enabledEvents||-1!==s.enabledEvents.indexOf(e)}function g(e,t){switch(e){case"ADD_TO_CART":case"REMOVE_FROM_CART":return function(e){if(!e)return{};var t={};if(e.crtItm){var n=h(e.crtItm);t.productId=n.productId,t.variantId=n.variantId,t.quantity=n.quantity,t.price=n.price}if(e.crt){var r=function(e){if(!e)return{};var t={cartId:e.id||null,currency:e.c||"TRY",cartTotalPrice:e.pr||null,cartItemCount:e.il?e.il.length:null};return e.il&&Array.isArray(e.il)&&(t.items=e.il.map(function(e){return h(e)})),t}(e.crt);t.cartId=r.cartId,t.currency=r.currency,t.cartTotalPrice=r.cartTotalPrice,t.cartItemCount=r.cartItemCount,t.cartItems=r.items}return t}(t);case"COMPLETE_CHECKOUT":return function(e){if(!e)return{};var t={},n=e.ord||e;t.orderId=n.id||n.oid||null,t.orderNumber=n.on||n.orderNumber||null,t.totalPrice=n.pr||n.tp||null,t.currency=n.c||"TRY";var r=n.il||n.items;return r&&Array.isArray(r)&&(t.itemCount=r.length,t.items=r.map(function(e){return h(e)})),t}(t);case"ADD_TO_WISHLIST":return function(e){if(!e)return{};var t=e.pr||e.prd||e;return{productId:t.id||t.pid||null,variantId:t.vid||null}}(t);default:return t||{}}}function R(t){try{if(!t)return;var n=t.e&&Array.isArray(t.e);if(t.type&&!t.e){var r=function(t){if(!t)return null;if("number"==typeof t)return y(t);var n=t.toUpperCase().replace(/[_\-\s]/g,"");return e.SUPPORTED_EVENTS[n]||null}(t.type);if(!r||!w(r))return;return void C({eventId:T(),type:r,occurredAt:(new Date).toISOString(),data:t.data||{},page:v(),customer:u||A()})}if(!n)return;if(l=t,t.ud&&(t.ud.id||t.ud.em)){u={id:t.ud.id||null,email:t.ud.em||null,firstName:t.ud.fn||null,lastName:t.ud.ln||null,phone:t.ud.ph||null,isGuest:!1};try{sessionStorage.setItem(e.CUSTOMER_KEY,JSON.stringify(u))}catch(e){}}var i=u||A();t.e.forEach(function(e){var t=y(e.t);if(t&&w(t)){var n=g(t,e.d&&e.d.d?e.d.d:{}),r=v();e.d&&(e.d.u&&(r.url=e.d.u),e.d.r&&(r.referrer=e.d.r)),C({eventId:e.id||T(),type:t,occurredAt:e.ts?new Date(e.ts).toISOString():(new Date).toISOString(),data:n,page:r,customer:i})}})}catch(e){}}function M(){return void 0!==window.IkasEvents&&"function"==typeof window.IkasEvents.subscribe&&(window.IkasEvents.subscribe({id:e.SUBSCRIBE_ID,callback:R}),!0)}}();