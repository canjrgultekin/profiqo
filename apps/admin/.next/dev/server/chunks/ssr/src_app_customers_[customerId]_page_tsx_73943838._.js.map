{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/source/canjrgultekin/profiqo/apps/admin/src/app/customers/%5BcustomerId%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useParams } from \"next/navigation\";\r\n\r\ntype IdentityDto = {\r\n  type: string;\r\n  valueHash: string;\r\n  sourceProvider: string | null;\r\n  sourceExternalId: string | null;\r\n  firstSeenAtUtc: string;\r\n  lastSeenAtUtc: string;\r\n};\r\n\r\ntype CustomerDto = {\r\n  customerId: string;\r\n  firstName: string | null;\r\n  lastName: string | null;\r\n  firstSeenAtUtc: string;\r\n  lastSeenAtUtc: string;\r\n  createdAtUtc: string;\r\n  updatedAtUtc: string;\r\n  identities: IdentityDto[];\r\n  rfm: any;\r\n  ai: any;\r\n};\r\n\r\ntype OrderRow = {\r\n  orderId: string;\r\n  providerOrderId: string | null;\r\n  channel: string;\r\n  status: string;\r\n  placedAtUtc: string;\r\n  totalAmount: number;\r\n  totalCurrency: string;\r\n  netProfit: number;\r\n  netProfitCurrency: string;\r\n  lineCount: number;\r\n};\r\n\r\nexport default function CustomerDetailPage() {\r\n  const params = useParams<{ customerId: string }>();\r\n  const customerId = params?.customerId;\r\n\r\n  const [cust, setCust] = useState<CustomerDto | null>(null);\r\n  const [orders, setOrders] = useState<OrderRow[]>([]);\r\n  const [err, setErr] = useState<string | null>(null);\r\n\r\n  const load = async (id: string) => {\r\n    setErr(null);\r\n\r\n    const cRes = await fetch(`/api/customers/${id}`, { cache: \"no-store\" });\r\n    const cPayload = await cRes.json().catch(() => null);\r\n\r\n    if (!cRes.ok) {\r\n      setErr(cPayload?.message || \"Failed to load customer.\");\r\n      return;\r\n    }\r\n\r\n    setCust(cPayload);\r\n\r\n    const oRes = await fetch(`/api/customers/${id}/orders`, { cache: \"no-store\" });\r\n    const oPayload = await oRes.json().catch(() => null);\r\n\r\n    if (!oRes.ok) {\r\n      setErr(oPayload?.message || \"Failed to load orders.\");\r\n      return;\r\n    }\r\n\r\n    setOrders(oPayload?.items || []);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!customerId) return;\r\n    load(customerId);\r\n  }, [customerId]);\r\n\r\n  if (!customerId) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"rounded-[10px] bg-white p-4 shadow-1 dark:bg-gray-dark dark:shadow-card\">\r\n          Loading...\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (err) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"rounded-[10px] bg-white p-4 shadow-1 dark:bg-gray-dark dark:shadow-card text-red-600\">\r\n          {err}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!cust) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"rounded-[10px] bg-white p-4 shadow-1 dark:bg-gray-dark dark:shadow-card\">\r\n          Loading...\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const name = `${cust.firstName || \"\"} ${cust.lastName || \"\"}`.trim() || cust.customerId;\r\n\r\n  return (\r\n    <div className=\"p-4 sm:p-6\">\r\n      <div className=\"mb-4 rounded-[10px] bg-white p-4 shadow-1 dark:bg-gray-dark dark:shadow-card\">\r\n        <h2 className=\"text-lg font-semibold text-dark dark:text-white\">Customer 360</h2>\r\n        <div className=\"mt-2 text-sm text-body-color dark:text-dark-6\">\r\n          <div><b>Name:</b> {name}</div>\r\n          <div><b>CustomerId:</b> {cust.customerId}</div>\r\n          <div><b>First Seen:</b> {new Date(cust.firstSeenAtUtc).toLocaleString()}</div>\r\n          <div><b>Last Seen:</b> {new Date(cust.lastSeenAtUtc).toLocaleString()}</div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"mb-4 rounded-[10px] bg-white p-4 shadow-1 dark:bg-gray-dark dark:shadow-card\">\r\n        <h3 className=\"text-md font-semibold text-dark dark:text-white\">Identities</h3>\r\n        <div className=\"mt-3 overflow-x-auto\">\r\n          <table className=\"w-full table-auto\">\r\n            <thead>\r\n              <tr className=\"text-left text-xs text-body-color dark:text-dark-6\">\r\n                <th className=\"px-2 py-2\">Type</th>\r\n                <th className=\"px-2 py-2\">Hash</th>\r\n                <th className=\"px-2 py-2\">Source</th>\r\n                <th className=\"px-2 py-2\">ExternalId</th>\r\n                <th className=\"px-2 py-2\">Last Seen</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {cust.identities.map((i, idx) => (\r\n                <tr key={idx} className=\"border-t border-stroke dark:border-dark-3 text-xs\">\r\n                  <td className=\"px-2 py-2\">{i.type}</td>\r\n                  <td className=\"px-2 py-2 font-mono\">{i.valueHash.slice(0, 16)}â€¦</td>\r\n                  <td className=\"px-2 py-2\">{i.sourceProvider || \"-\"}</td>\r\n                  <td className=\"px-2 py-2\">{i.sourceExternalId || \"-\"}</td>\r\n                  <td className=\"px-2 py-2\">{new Date(i.lastSeenAtUtc).toLocaleString()}</td>\r\n                </tr>\r\n              ))}\r\n              {!cust.identities.length && (\r\n                <tr className=\"border-t border-stroke dark:border-dark-3 text-xs\">\r\n                  <td className=\"px-2 py-2\" colSpan={5}>No identities</td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"rounded-[10px] bg-white p-4 shadow-1 dark:bg-gray-dark dark:shadow-card\">\r\n        <h3 className=\"text-md font-semibold text-dark dark:text-white\">Orders</h3>\r\n        <div className=\"mt-3 overflow-x-auto\">\r\n          <table className=\"w-full table-auto\">\r\n            <thead>\r\n              <tr className=\"text-left text-xs text-body-color dark:text-dark-6\">\r\n                <th className=\"px-2 py-2\">Order</th>\r\n                <th className=\"px-2 py-2\">Channel</th>\r\n                <th className=\"px-2 py-2\">Placed</th>\r\n                <th className=\"px-2 py-2\">Total</th>\r\n                <th className=\"px-2 py-2\">Lines</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {orders.map((o) => (\r\n                <tr key={o.orderId} className=\"border-t border-stroke dark:border-dark-3 text-xs\">\r\n                  <td className=\"px-2 py-2\">\r\n                    <a className=\"underline\" href={`/orders/${o.orderId}`}>\r\n                      {o.providerOrderId || o.orderId}\r\n                    </a>\r\n                  </td>\r\n                  <td className=\"px-2 py-2\">{o.channel}</td>\r\n                  <td className=\"px-2 py-2\">{new Date(o.placedAtUtc).toLocaleString()}</td>\r\n                  <td className=\"px-2 py-2\">{o.totalAmount} {o.totalCurrency}</td>\r\n                  <td className=\"px-2 py-2\">{o.lineCount}</td>\r\n                </tr>\r\n              ))}\r\n              {!orders.length && (\r\n                <tr className=\"border-t border-stroke dark:border-dark-3 text-xs\">\r\n                  <td className=\"px-2 py-2\" colSpan={5}>No orders</td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAwCe,SAAS;IACtB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,aAAa,QAAQ;IAE3B,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAqB;IACrD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAa,EAAE;IACnD,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,iNAAQ,EAAgB;IAE9C,MAAM,OAAO,OAAO;QAClB,OAAO;QAEP,MAAM,OAAO,MAAM,MAAM,CAAC,eAAe,EAAE,IAAI,EAAE;YAAE,OAAO;QAAW;QACrE,MAAM,WAAW,MAAM,KAAK,IAAI,GAAG,KAAK,CAAC,IAAM;QAE/C,IAAI,CAAC,KAAK,EAAE,EAAE;YACZ,OAAO,UAAU,WAAW;YAC5B;QACF;QAEA,QAAQ;QAER,MAAM,OAAO,MAAM,MAAM,CAAC,eAAe,EAAE,GAAG,OAAO,CAAC,EAAE;YAAE,OAAO;QAAW;QAC5E,MAAM,WAAW,MAAM,KAAK,IAAI,GAAG,KAAK,CAAC,IAAM;QAE/C,IAAI,CAAC,KAAK,EAAE,EAAE;YACZ,OAAO,UAAU,WAAW;YAC5B;QACF;QAEA,UAAU,UAAU,SAAS,EAAE;IACjC;IAEA,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,YAAY;QACjB,KAAK;IACP,GAAG;QAAC;KAAW;IAEf,IAAI,CAAC,YAAY;QACf,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BAA0E;;;;;;;;;;;IAK/F;IAEA,IAAI,KAAK;QACP,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BACZ;;;;;;;;;;;IAIT;IAEA,IAAI,CAAC,MAAM;QACT,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BAA0E;;;;;;;;;;;IAK/F;IAEA,MAAM,OAAO,GAAG,KAAK,SAAS,IAAI,GAAG,CAAC,EAAE,KAAK,QAAQ,IAAI,IAAI,CAAC,IAAI,MAAM,KAAK,UAAU;IAEvF,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAAkD;;;;;;kCAChE,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;;kDAAI,8OAAC;kDAAE;;;;;;oCAAS;oCAAE;;;;;;;0CACnB,8OAAC;;kDAAI,8OAAC;kDAAE;;;;;;oCAAe;oCAAE,KAAK,UAAU;;;;;;;0CACxC,8OAAC;;kDAAI,8OAAC;kDAAE;;;;;;oCAAe;oCAAE,IAAI,KAAK,KAAK,cAAc,EAAE,cAAc;;;;;;;0CACrE,8OAAC;;kDAAI,8OAAC;kDAAE;;;;;;oCAAc;oCAAE,IAAI,KAAK,KAAK,aAAa,EAAE,cAAc;;;;;;;;;;;;;;;;;;;0BAIvE,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAAkD;;;;;;kCAChE,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC;4BAAM,WAAU;;8CACf,8OAAC;8CACC,cAAA,8OAAC;wCAAG,WAAU;;0DACZ,8OAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,8OAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,8OAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,8OAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,8OAAC;gDAAG,WAAU;0DAAY;;;;;;;;;;;;;;;;;8CAG9B,8OAAC;;wCACE,KAAK,UAAU,CAAC,GAAG,CAAC,CAAC,GAAG,oBACvB,8OAAC;gDAAa,WAAU;;kEACtB,8OAAC;wDAAG,WAAU;kEAAa,EAAE,IAAI;;;;;;kEACjC,8OAAC;wDAAG,WAAU;;4DAAuB,EAAE,SAAS,CAAC,KAAK,CAAC,GAAG;4DAAI;;;;;;;kEAC9D,8OAAC;wDAAG,WAAU;kEAAa,EAAE,cAAc,IAAI;;;;;;kEAC/C,8OAAC;wDAAG,WAAU;kEAAa,EAAE,gBAAgB,IAAI;;;;;;kEACjD,8OAAC;wDAAG,WAAU;kEAAa,IAAI,KAAK,EAAE,aAAa,EAAE,cAAc;;;;;;;+CAL5D;;;;;wCAQV,CAAC,KAAK,UAAU,CAAC,MAAM,kBACtB,8OAAC;4CAAG,WAAU;sDACZ,cAAA,8OAAC;gDAAG,WAAU;gDAAY,SAAS;0DAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAQlD,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAAkD;;;;;;kCAChE,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC;4BAAM,WAAU;;8CACf,8OAAC;8CACC,cAAA,8OAAC;wCAAG,WAAU;;0DACZ,8OAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,8OAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,8OAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,8OAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,8OAAC;gDAAG,WAAU;0DAAY;;;;;;;;;;;;;;;;;8CAG9B,8OAAC;;wCACE,OAAO,GAAG,CAAC,CAAC,kBACX,8OAAC;gDAAmB,WAAU;;kEAC5B,8OAAC;wDAAG,WAAU;kEACZ,cAAA,8OAAC;4DAAE,WAAU;4DAAY,MAAM,CAAC,QAAQ,EAAE,EAAE,OAAO,EAAE;sEAClD,EAAE,eAAe,IAAI,EAAE,OAAO;;;;;;;;;;;kEAGnC,8OAAC;wDAAG,WAAU;kEAAa,EAAE,OAAO;;;;;;kEACpC,8OAAC;wDAAG,WAAU;kEAAa,IAAI,KAAK,EAAE,WAAW,EAAE,cAAc;;;;;;kEACjE,8OAAC;wDAAG,WAAU;;4DAAa,EAAE,WAAW;4DAAC;4DAAE,EAAE,aAAa;;;;;;;kEAC1D,8OAAC;wDAAG,WAAU;kEAAa,EAAE,SAAS;;;;;;;+CAT/B,EAAE,OAAO;;;;;wCAYnB,CAAC,OAAO,MAAM,kBACb,8OAAC;4CAAG,WAAU;sDACZ,cAAA,8OAAC;gDAAG,WAAU;gDAAY,SAAS;0DAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASxD"}}]
}