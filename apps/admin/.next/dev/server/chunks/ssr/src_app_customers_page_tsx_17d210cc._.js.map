{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/source/canjrgultekin/profiqo/apps/admin/src/app/customers/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useMemo, useState } from \"react\";\r\n\r\ntype CustomerRow = {\r\n  customerId: string;\r\n  firstName: string | null;\r\n  lastName: string | null;\r\n  firstSeenAtUtc: string;\r\n  lastSeenAtUtc: string;\r\n  rfmSegment: string | null;\r\n  churnRisk: number | null;\r\n  ltv12mProfit: number | null;\r\n};\r\n\r\ntype CustomersResponse = {\r\n  page: number;\r\n  pageSize: number;\r\n  total: number;\r\n  items: CustomerRow[];\r\n};\r\n\r\nexport default function CustomersPage() {\r\n  const [q, setQ] = useState(\"\");\r\n  const [page, setPage] = useState(1);\r\n  const pageSize = 25;\r\n\r\n  const [loading, setLoading] = useState(false);\r\n  const [err, setErr] = useState<string | null>(null);\r\n  const [data, setData] = useState<CustomersResponse | null>(null);\r\n\r\n  const totalPages = useMemo(() => {\r\n    if (!data) return 1;\r\n    return Math.max(1, Math.ceil(data.total / data.pageSize));\r\n  }, [data]);\r\n\r\n  const load = async () => {\r\n    setLoading(true);\r\n    setErr(null);\r\n\r\n    const qs = new URLSearchParams({\r\n      page: String(page),\r\n      pageSize: String(pageSize),\r\n    });\r\n    if (q.trim()) qs.set(\"q\", q.trim());\r\n\r\n    try {\r\n      const res = await fetch(`/api/customers?${qs.toString()}`, { method: \"GET\", cache: \"no-store\" });\r\n      const payload = (await res.json().catch(() => null)) as any;\r\n\r\n      if (!res.ok) {\r\n        setErr(payload?.message || \"Customers load failed.\");\r\n        setData(null);\r\n        return;\r\n      }\r\n\r\n      setData(payload);\r\n    } catch {\r\n      setErr(\"Customers load failed (network).\");\r\n      setData(null);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => { load(); }, [page]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  return (\r\n    <div className=\"p-4 sm:p-6\">\r\n      <div className=\"mb-4 flex flex-wrap items-end gap-3\">\r\n        <div className=\"flex flex-col\">\r\n          <label className=\"text-sm text-body-color dark:text-dark-6\">Search</label>\r\n          <input\r\n            className=\"w-[320px] rounded-lg border border-stroke bg-transparent px-4 py-2 text-dark outline-none focus:border-primary dark:border-dark-3 dark:text-white\"\r\n            value={q}\r\n            onChange={(e) => setQ(e.target.value)}\r\n            placeholder=\"First name / last name\"\r\n          />\r\n        </div>\r\n\r\n        <button\r\n          onClick={() => { setPage(1); load(); }}\r\n          className=\"rounded-lg bg-primary px-4 py-2 font-medium text-white hover:bg-opacity-90 disabled:opacity-60\"\r\n          disabled={loading}\r\n        >\r\n          Search\r\n        </button>\r\n      </div>\r\n\r\n      {err && (\r\n        <div className=\"mb-4 rounded-lg border border-red-500/30 bg-red-500/10 px-4 py-3 text-sm text-red-600 dark:text-red-400\">\r\n          {err}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"rounded-[10px] bg-white p-4 shadow-1 dark:bg-gray-dark dark:shadow-card\">\r\n        <div className=\"mb-3 flex items-center justify-between\">\r\n          <h2 className=\"text-lg font-semibold text-dark dark:text-white\">Customers</h2>\r\n          <div className=\"text-sm text-body-color dark:text-dark-6\">{data ? `${data.total} total` : \"\"}</div>\r\n        </div>\r\n\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"w-full table-auto\">\r\n            <thead>\r\n              <tr className=\"text-left text-sm text-body-color dark:text-dark-6\">\r\n                <th className=\"px-3 py-2\">Name</th>\r\n                <th className=\"px-3 py-2\">RFM</th>\r\n                <th className=\"px-3 py-2\">Churn</th>\r\n                <th className=\"px-3 py-2\">LTV (12m)</th>\r\n                <th className=\"px-3 py-2\">Last Seen</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {loading && (\r\n                <tr><td className=\"px-3 py-3 text-sm\" colSpan={5}>Loading...</td></tr>\r\n              )}\r\n\r\n              {!loading && data?.items?.length ? (\r\n                data.items.map((x) => (\r\n                  <tr key={x.customerId} className=\"border-t border-stroke dark:border-dark-3\">\r\n                    <td className=\"px-3 py-3 text-sm text-dark dark:text-white\">\r\n                      <a className=\"underline\" href={`/customers/${x.customerId}`}>\r\n                        {`${x.firstName || \"\"} ${x.lastName || \"\"}`.trim() || x.customerId}\r\n                      </a>\r\n                    </td>\r\n                    <td className=\"px-3 py-3 text-sm\">{x.rfmSegment || \"-\"}</td>\r\n                    <td className=\"px-3 py-3 text-sm\">{x.churnRisk ?? \"-\"}</td>\r\n                    <td className=\"px-3 py-3 text-sm\">{x.ltv12mProfit ?? \"-\"}</td>\r\n                    <td className=\"px-3 py-3 text-sm\">{new Date(x.lastSeenAtUtc).toLocaleString()}</td>\r\n                  </tr>\r\n                ))\r\n              ) : (\r\n                !loading && (\r\n                  <tr><td className=\"px-3 py-3 text-sm\" colSpan={5}>No customers.</td></tr>\r\n                )\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        <div className=\"mt-4 flex items-center justify-between\">\r\n          <button className=\"rounded-lg border border-stroke px-3 py-2 text-sm dark:border-dark-3\"\r\n            onClick={() => setPage((p) => Math.max(1, p - 1))}\r\n            disabled={loading || page <= 1}>\r\n            Prev\r\n          </button>\r\n\r\n          <div className=\"text-sm text-body-color dark:text-dark-6\">\r\n            Page {page} / {totalPages}\r\n          </div>\r\n\r\n          <button className=\"rounded-lg border border-stroke px-3 py-2 text-sm dark:border-dark-3\"\r\n            onClick={() => setPage((p) => Math.min(totalPages, p + 1))}\r\n            disabled={loading || page >= totalPages}>\r\n            Next\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}