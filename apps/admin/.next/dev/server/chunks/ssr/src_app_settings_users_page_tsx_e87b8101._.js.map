{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/source/canjrgultekin/profiqo/apps/admin/src/app/settings/users/page.tsx"],"sourcesContent":["// Path: apps/admin/src/app/settings/users/page.tsx\r\n\"use client\";\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\n\r\ntype UserItem = {\r\n  userId: string;\r\n  email: string;\r\n  displayName: string;\r\n  status: string;\r\n  roles: string[] | string | null;\r\n  createdAtUtc: string;\r\n};\r\n\r\nfunction normalizeRoles(r: UserItem[\"roles\"]): string[] {\r\n  if (!r) return [];\r\n  if (Array.isArray(r)) return r.filter(Boolean);\r\n  const s = String(r).trim();\r\n  if (!s) return [];\r\n  // \"Admin,Reporting\" gibi gelirse split et\r\n  return s.split(\",\").map((x) => x.trim()).filter(Boolean);\r\n}\r\n\r\nexport default function TenantUsersPage() {\r\n  const [items, setItems] = useState<UserItem[]>([]);\r\n  const [err, setErr] = useState<string | null>(null);\r\n\r\n  const [form, setForm] = useState({\r\n    email: \"\",\r\n    displayName: \"\",\r\n    password: \"\",\r\n    role: \"Reporting\",\r\n  });\r\n\r\n  const load = async () => {\r\n    setErr(null);\r\n    const res = await fetch(\"/api/tenant/users\", { cache: \"no-store\" });\r\n    const payload = await res.json().catch(() => null);\r\n\r\n    if (!res.ok) {\r\n      setErr(payload?.message || \"Failed to load users.\");\r\n      setItems([]);\r\n      return;\r\n    }\r\n\r\n    const raw = payload?.items || [];\r\n    const mapped: UserItem[] = Array.isArray(raw)\r\n      ? raw.map((u: any) => ({\r\n          userId: u?.userId ?? u?.UserId ?? \"\",\r\n          email: u?.email ?? u?.Email ?? \"\",\r\n          displayName: u?.displayName ?? u?.DisplayName ?? \"\",\r\n          status: u?.status ?? u?.Status ?? \"\",\r\n          roles: u?.roles ?? u?.Roles ?? null,\r\n          createdAtUtc: u?.createdAtUtc ?? u?.CreatedAtUtc ?? \"\",\r\n        }))\r\n      : [];\r\n\r\n    setItems(mapped);\r\n  };\r\n\r\n  useEffect(() => {\r\n    load();\r\n  }, []);\r\n\r\n  const createUser = async () => {\r\n    setErr(null);\r\n\r\n    const res = await fetch(\"/api/tenant/users\", {\r\n      method: \"POST\",\r\n      headers: { \"content-type\": \"application/json\" },\r\n      body: JSON.stringify(form),\r\n    });\r\n\r\n    const payload = await res.json().catch(() => null);\r\n\r\n    if (!res.ok) {\r\n      setErr(payload?.message || JSON.stringify(payload));\r\n      return;\r\n    }\r\n\r\n    setForm({ email: \"\", displayName: \"\", password: \"\", role: \"Reporting\" });\r\n    await load();\r\n  };\r\n\r\n  const disable = async (id: string) => {\r\n    const res = await fetch(`/api/tenant/users/${id}/disable`, { method: \"POST\" });\r\n    if (!res.ok) setErr(\"Disable failed.\");\r\n    await load();\r\n  };\r\n\r\n  const activate = async (id: string) => {\r\n    const res = await fetch(`/api/tenant/users/${id}/activate`, { method: \"POST\" });\r\n    if (!res.ok) setErr(\"Activate failed.\");\r\n    await load();\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4 sm:p-6\">\r\n      <div className=\"rounded-[10px] bg-white p-4 shadow-1 dark:bg-gray-dark dark:shadow-card\">\r\n        <h2 className=\"text-lg font-semibold text-dark dark:text-white\">Firma Kullanıcıları</h2>\r\n\r\n        {err && (\r\n          <div className=\"mt-3 rounded-lg border border-red-500/30 bg-red-500/10 px-4 py-3 text-sm text-red-600 dark:text-red-400\">\r\n            {err}\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"mt-4 grid gap-3 md:grid-cols-4\">\r\n          <input\r\n            className=\"rounded-lg border border-stroke bg-transparent px-3 py-2 text-dark dark:text-white dark:border-dark-3\"\r\n            placeholder=\"email\"\r\n            value={form.email}\r\n            onChange={(e) => setForm({ ...form, email: e.target.value })}\r\n          />\r\n          <input\r\n            className=\"rounded-lg border border-stroke bg-transparent px-3 py-2 text-dark dark:text-white dark:border-dark-3\"\r\n            placeholder=\"display name\"\r\n            value={form.displayName}\r\n            onChange={(e) => setForm({ ...form, displayName: e.target.value })}\r\n          />\r\n          <input\r\n            className=\"rounded-lg border border-stroke bg-transparent px-3 py-2 text-dark dark:text-white dark:border-dark-3\"\r\n            placeholder=\"password (min 8)\"\r\n            type=\"password\"\r\n            value={form.password}\r\n            onChange={(e) => setForm({ ...form, password: e.target.value })}\r\n          />\r\n          <select\r\n            className=\"rounded-lg border border-stroke bg-transparent px-3 py-2 text-dark dark:text-white dark:border-dark-3\"\r\n            value={form.role}\r\n            onChange={(e) => setForm({ ...form, role: e.target.value })}\r\n          >\r\n            <option value=\"Admin\">Admin</option>\r\n            <option value=\"Integration\">Integration</option>\r\n            <option value=\"Reporting\">Reporting</option>\r\n          </select>\r\n        </div>\r\n\r\n        <button\r\n          onClick={createUser}\r\n          className=\"mt-3 rounded-lg bg-primary px-4 py-2 font-medium text-white hover:bg-opacity-90\"\r\n        >\r\n          Kullanıcı Oluştur\r\n        </button>\r\n\r\n        <div className=\"mt-6 overflow-x-auto\">\r\n          <table className=\"w-full table-auto\">\r\n            <thead>\r\n              <tr className=\"text-left text-xs text-body-color dark:text-dark-6\">\r\n                <th className=\"px-2 py-2\">Email</th>\r\n                <th className=\"px-2 py-2\">Name</th>\r\n                <th className=\"px-2 py-2\">Roles</th>\r\n                <th className=\"px-2 py-2\">Status</th>\r\n                <th className=\"px-2 py-2\">Action</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {items.map((u) => {\r\n                const rolesArr = normalizeRoles(u.roles);\r\n\r\n                return (\r\n                  <tr key={u.userId} className=\"border-t border-stroke dark:border-dark-3 text-sm\">\r\n                    <td className=\"px-2 py-2\">{u.email}</td>\r\n                    <td className=\"px-2 py-2\">{u.displayName}</td>\r\n                    <td className=\"px-2 py-2\">{rolesArr.length ? rolesArr.join(\", \") : \"-\"}</td>\r\n                    <td className=\"px-2 py-2\">{u.status}</td>\r\n                    <td className=\"px-2 py-2\">\r\n                      {u.status === \"Active\" ? (\r\n                        <button className=\"rounded border px-2 py-1\" onClick={() => disable(u.userId)}>\r\n                          Disable\r\n                        </button>\r\n                      ) : (\r\n                        <button className=\"rounded border px-2 py-1\" onClick={() => activate(u.userId)}>\r\n                          Activate\r\n                        </button>\r\n                      )}\r\n                    </td>\r\n                  </tr>\r\n                );\r\n              })}\r\n\r\n              {!items.length && (\r\n                <tr className=\"border-t border-stroke dark:border-dark-3 text-sm\">\r\n                  <td className=\"px-2 py-3\" colSpan={5}>\r\n                    No users\r\n                  </td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}