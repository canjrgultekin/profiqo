{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/source/canjrgultekin/profiqo/apps/admin/src/app/api/orders/%5BorderId%5D/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { cookies } from \"next/headers\";\r\n\r\nconst ACCESS_COOKIE = \"profiqo_access_token\";\r\nconst TENANT_COOKIE = \"profiqo_tenant_id\";\r\nconst ROLES_COOKIE = \"profiqo_roles\";\r\n\r\nfunction backendBaseUrl(): string {\r\n  return process.env.PROFIQO_BACKEND_URL?.trim() || \"http://localhost:5164\";\r\n}\r\n\r\nfunction clear(res: NextResponse) {\r\n  res.cookies.set(ACCESS_COOKIE, \"\", { path: \"/\", maxAge: 0 });\r\n  res.cookies.set(TENANT_COOKIE, \"\", { path: \"/\", maxAge: 0 });\r\n  res.cookies.set(ROLES_COOKIE, \"\", { path: \"/\", maxAge: 0 });\r\n}\r\n\r\nasync function resolveParams(ctx: any): Promise<{ orderId: string }> {\r\n  if (ctx?.params && typeof ctx.params?.then === \"function\") return await ctx.params;\r\n  if (ctx && typeof ctx?.then === \"function\") {\r\n    const awaited = await ctx;\r\n    if (awaited?.params && typeof awaited.params?.then === \"function\") return await awaited.params;\r\n    return awaited?.params;\r\n  }\r\n  return ctx?.params;\r\n}\r\n\r\nexport async function GET(_req: Request, ctx: any) {\r\n  const params = await resolveParams(ctx);\r\n  const orderId = params?.orderId;\r\n\r\n  if (!orderId) return NextResponse.json({ message: \"orderId missing\" }, { status: 400 });\r\n\r\n  const cs = await cookies();\r\n  const token = cs.get(ACCESS_COOKIE)?.value;\r\n  const tenantId = cs.get(TENANT_COOKIE)?.value;\r\n\r\n  if (!token) return NextResponse.json({ message: \"Unauthorized\" }, { status: 401 });\r\n  if (!tenantId) return NextResponse.json({ message: \"Tenant cookie missing\" }, { status: 400 });\r\n\r\n  const upstream = await fetch(`${backendBaseUrl()}/api/orders/${orderId}`, {\r\n    method: \"GET\",\r\n    headers: { Authorization: `Bearer ${token}`, \"X-Tenant-Id\": tenantId },\r\n    cache: \"no-store\",\r\n  });\r\n\r\n  const text = await upstream.text();\r\n  if (upstream.status === 401) {\r\n    const res = NextResponse.json({ message: \"Unauthorized\" }, { status: 401 });\r\n    clear(res);\r\n    return res;\r\n  }\r\n\r\n  let payload: any;\r\n  try { payload = text ? JSON.parse(text) : null; }\r\n  catch { payload = { message: \"Backend returned non-JSON\", raw: text?.slice(0, 2000) || \"\" }; }\r\n\r\n  return NextResponse.json(payload, { status: upstream.status });\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,gBAAgB;AACtB,MAAM,gBAAgB;AACtB,MAAM,eAAe;AAErB,SAAS;IACP,OAAO,QAAQ,GAAG,CAAC,mBAAmB,EAAE,UAAU;AACpD;AAEA,SAAS,MAAM,GAAiB;IAC9B,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe,IAAI;QAAE,MAAM;QAAK,QAAQ;IAAE;IAC1D,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe,IAAI;QAAE,MAAM;QAAK,QAAQ;IAAE;IAC1D,IAAI,OAAO,CAAC,GAAG,CAAC,cAAc,IAAI;QAAE,MAAM;QAAK,QAAQ;IAAE;AAC3D;AAEA,eAAe,cAAc,GAAQ;IACnC,IAAI,KAAK,UAAU,OAAO,IAAI,MAAM,EAAE,SAAS,YAAY,OAAO,MAAM,IAAI,MAAM;IAClF,IAAI,OAAO,OAAO,KAAK,SAAS,YAAY;QAC1C,MAAM,UAAU,MAAM;QACtB,IAAI,SAAS,UAAU,OAAO,QAAQ,MAAM,EAAE,SAAS,YAAY,OAAO,MAAM,QAAQ,MAAM;QAC9F,OAAO,SAAS;IAClB;IACA,OAAO,KAAK;AACd;AAEO,eAAe,IAAI,IAAa,EAAE,GAAQ;IAC/C,MAAM,SAAS,MAAM,cAAc;IACnC,MAAM,UAAU,QAAQ;IAExB,IAAI,CAAC,SAAS,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,SAAS;IAAkB,GAAG;QAAE,QAAQ;IAAI;IAErF,MAAM,KAAK,MAAM,IAAA,4IAAO;IACxB,MAAM,QAAQ,GAAG,GAAG,CAAC,gBAAgB;IACrC,MAAM,WAAW,GAAG,GAAG,CAAC,gBAAgB;IAExC,IAAI,CAAC,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,SAAS;IAAe,GAAG;QAAE,QAAQ;IAAI;IAChF,IAAI,CAAC,UAAU,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,SAAS;IAAwB,GAAG;QAAE,QAAQ;IAAI;IAE5F,MAAM,WAAW,MAAM,MAAM,GAAG,iBAAiB,YAAY,EAAE,SAAS,EAAE;QACxE,QAAQ;QACR,SAAS;YAAE,eAAe,CAAC,OAAO,EAAE,OAAO;YAAE,eAAe;QAAS;QACrE,OAAO;IACT;IAEA,MAAM,OAAO,MAAM,SAAS,IAAI;IAChC,IAAI,SAAS,MAAM,KAAK,KAAK;QAC3B,MAAM,MAAM,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAe,GAAG;YAAE,QAAQ;QAAI;QACzE,MAAM;QACN,OAAO;IACT;IAEA,IAAI;IACJ,IAAI;QAAE,UAAU,OAAO,KAAK,KAAK,CAAC,QAAQ;IAAM,EAChD,OAAM;QAAE,UAAU;YAAE,SAAS;YAA6B,KAAK,MAAM,MAAM,GAAG,SAAS;QAAG;IAAG;IAE7F,OAAO,gJAAY,CAAC,IAAI,CAAC,SAAS;QAAE,QAAQ,SAAS,MAAM;IAAC;AAC9D"}}]
}