{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/source/canjrgultekin/profiqo/apps/admin/src/app/api/customers/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { cookies } from \"next/headers\";\r\n\r\nconst ACCESS_COOKIE = \"profiqo_access_token\";\r\nconst TENANT_COOKIE = \"profiqo_tenant_id\";\r\nconst ROLES_COOKIE = \"profiqo_roles\";\r\n\r\nfunction backendBaseUrl(): string {\r\n  return process.env.PROFIQO_BACKEND_URL?.trim() || \"http://localhost:5164\";\r\n}\r\n\r\nfunction clearAuthCookies(res: NextResponse) {\r\n  res.cookies.set(ACCESS_COOKIE, \"\", { path: \"/\", maxAge: 0 });\r\n  res.cookies.set(TENANT_COOKIE, \"\", { path: \"/\", maxAge: 0 });\r\n  res.cookies.set(ROLES_COOKIE, \"\", { path: \"/\", maxAge: 0 });\r\n}\r\n\r\nexport async function GET(req: Request) {\r\n  const url = new URL(req.url);\r\n  const page = url.searchParams.get(\"page\") || \"1\";\r\n  const pageSize = url.searchParams.get(\"pageSize\") || \"25\";\r\n  const q = url.searchParams.get(\"q\");\r\n\r\n  const cookieStore = await cookies();\r\n  const token = cookieStore.get(ACCESS_COOKIE)?.value;\r\n  const tenantId = cookieStore.get(TENANT_COOKIE)?.value;\r\n\r\n  if (!token) return NextResponse.json({ message: \"Unauthorized\" }, { status: 401 });\r\n  if (!tenantId) return NextResponse.json({ message: \"Tenant cookie missing\" }, { status: 400 });\r\n\r\n  const qs = new URLSearchParams({ page, pageSize });\r\n  if (q) qs.set(\"q\", q);\r\n\r\n  const upstream = await fetch(`${backendBaseUrl()}/api/customers?${qs.toString()}`, {\r\n    method: \"GET\",\r\n    headers: { Authorization: `Bearer ${token}`, \"X-Tenant-Id\": tenantId },\r\n    cache: \"no-store\",\r\n  });\r\n\r\n  const text = await upstream.text();\r\n\r\n  if (upstream.status === 401) {\r\n    const res = NextResponse.json({ message: \"Unauthorized\" }, { status: 401 });\r\n    clearAuthCookies(res);\r\n    return res;\r\n  }\r\n\r\n  let payload: any = null;\r\n  try {\r\n    payload = text ? JSON.parse(text) : null;\r\n  } catch {\r\n    payload = { message: \"Backend returned non-JSON\", raw: text?.slice(0, 2000) || \"\" };\r\n  }\r\n\r\n  return NextResponse.json(payload, { status: upstream.status });\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,gBAAgB;AACtB,MAAM,gBAAgB;AACtB,MAAM,eAAe;AAErB,SAAS;IACP,OAAO,QAAQ,GAAG,CAAC,mBAAmB,EAAE,UAAU;AACpD;AAEA,SAAS,iBAAiB,GAAiB;IACzC,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe,IAAI;QAAE,MAAM;QAAK,QAAQ;IAAE;IAC1D,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe,IAAI;QAAE,MAAM;QAAK,QAAQ;IAAE;IAC1D,IAAI,OAAO,CAAC,GAAG,CAAC,cAAc,IAAI;QAAE,MAAM;QAAK,QAAQ;IAAE;AAC3D;AAEO,eAAe,IAAI,GAAY;IACpC,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;IAC3B,MAAM,OAAO,IAAI,YAAY,CAAC,GAAG,CAAC,WAAW;IAC7C,MAAM,WAAW,IAAI,YAAY,CAAC,GAAG,CAAC,eAAe;IACrD,MAAM,IAAI,IAAI,YAAY,CAAC,GAAG,CAAC;IAE/B,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,gBAAgB;IAC9C,MAAM,WAAW,YAAY,GAAG,CAAC,gBAAgB;IAEjD,IAAI,CAAC,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,SAAS;IAAe,GAAG;QAAE,QAAQ;IAAI;IAChF,IAAI,CAAC,UAAU,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,SAAS;IAAwB,GAAG;QAAE,QAAQ;IAAI;IAE5F,MAAM,KAAK,IAAI,gBAAgB;QAAE;QAAM;IAAS;IAChD,IAAI,GAAG,GAAG,GAAG,CAAC,KAAK;IAEnB,MAAM,WAAW,MAAM,MAAM,GAAG,iBAAiB,eAAe,EAAE,GAAG,QAAQ,IAAI,EAAE;QACjF,QAAQ;QACR,SAAS;YAAE,eAAe,CAAC,OAAO,EAAE,OAAO;YAAE,eAAe;QAAS;QACrE,OAAO;IACT;IAEA,MAAM,OAAO,MAAM,SAAS,IAAI;IAEhC,IAAI,SAAS,MAAM,KAAK,KAAK;QAC3B,MAAM,MAAM,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAe,GAAG;YAAE,QAAQ;QAAI;QACzE,iBAAiB;QACjB,OAAO;IACT;IAEA,IAAI,UAAe;IACnB,IAAI;QACF,UAAU,OAAO,KAAK,KAAK,CAAC,QAAQ;IACtC,EAAE,OAAM;QACN,UAAU;YAAE,SAAS;YAA6B,KAAK,MAAM,MAAM,GAAG,SAAS;QAAG;IACpF;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,SAAS;QAAE,QAAQ,SAAS,MAAM;IAAC;AAC9D"}}]
}