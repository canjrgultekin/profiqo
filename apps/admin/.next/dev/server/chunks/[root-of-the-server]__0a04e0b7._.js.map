{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/source/canjrgultekin/profiqo/apps/admin/src/app/api/tenant/users/route.ts"],"sourcesContent":["// Path: apps/admin/src/app/api/tenant/users/route.ts\r\nimport { NextResponse } from \"next/server\";\r\nimport { cookies } from \"next/headers\";\r\n\r\nconst ACCESS_COOKIE = \"profiqo_access_token\";\r\nconst TENANT_COOKIE = \"profiqo_tenant_id\";\r\nconst ROLES_COOKIE = \"profiqo_roles\";\r\n\r\nfunction backendBaseUrl(): string {\r\n  return process.env.PROFIQO_BACKEND_URL?.trim() || \"http://localhost:5164\";\r\n}\r\n\r\nfunction clearAuthCookies(res: NextResponse) {\r\n  res.cookies.set(ACCESS_COOKIE, \"\", { path: \"/\", maxAge: 0 });\r\n  res.cookies.set(TENANT_COOKIE, \"\", { path: \"/\", maxAge: 0 });\r\n  res.cookies.set(ROLES_COOKIE, \"\", { path: \"/\", maxAge: 0 });\r\n}\r\n\r\nexport async function GET() {\r\n  const cs = await cookies();\r\n  const token = cs.get(ACCESS_COOKIE)?.value;\r\n  const tenantId = cs.get(TENANT_COOKIE)?.value;\r\n\r\n  if (!token) return NextResponse.json({ message: \"Unauthorized\" }, { status: 401 });\r\n  if (!tenantId) return NextResponse.json({ message: \"Tenant cookie missing\" }, { status: 400 });\r\n\r\n  const upstream = await fetch(`${backendBaseUrl()}/api/tenant/users`, {\r\n    method: \"GET\",\r\n    headers: { Authorization: `Bearer ${token}`, \"X-Tenant-Id\": tenantId },\r\n    cache: \"no-store\",\r\n  });\r\n\r\n  const text = await upstream.text();\r\n\r\n  if (upstream.status === 401) {\r\n    const res = NextResponse.json({ message: \"Unauthorized\" }, { status: 401 });\r\n    clearAuthCookies(res);\r\n    return res;\r\n  }\r\n\r\n  let payload: any;\r\n  try {\r\n    payload = text ? JSON.parse(text) : null;\r\n  } catch {\r\n    payload = { message: \"Backend returned non-JSON\", raw: text?.slice(0, 2000) || \"\" };\r\n  }\r\n\r\n  return NextResponse.json(payload, { status: upstream.status });\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n  const body = await req.json().catch(() => null);\r\n\r\n  const cs = await cookies();\r\n  const token = cs.get(ACCESS_COOKIE)?.value;\r\n  const tenantId = cs.get(TENANT_COOKIE)?.value;\r\n\r\n  if (!token) return NextResponse.json({ message: \"Unauthorized\" }, { status: 401 });\r\n  if (!tenantId) return NextResponse.json({ message: \"Tenant cookie missing\" }, { status: 400 });\r\n\r\n  const upstream = await fetch(`${backendBaseUrl()}/api/tenant/users`, {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"content-type\": \"application/json\",\r\n      Authorization: `Bearer ${token}`,\r\n      \"X-Tenant-Id\": tenantId,\r\n    },\r\n    body: JSON.stringify(body),\r\n    cache: \"no-store\",\r\n  });\r\n\r\n  const text = await upstream.text();\r\n\r\n  if (upstream.status === 401) {\r\n    const res = NextResponse.json({ message: \"Unauthorized\" }, { status: 401 });\r\n    clearAuthCookies(res);\r\n    return res;\r\n  }\r\n\r\n  let payload: any;\r\n  try {\r\n    payload = text ? JSON.parse(text) : null;\r\n  } catch {\r\n    payload = { message: \"Backend returned non-JSON\", raw: text?.slice(0, 2000) || \"\" };\r\n  }\r\n\r\n  return NextResponse.json(payload, { status: upstream.status });\r\n}\r\n"],"names":[],"mappings":"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"}}]
}